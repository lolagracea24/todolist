<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskFlow - Advanced Todo List</title>

    <!-- Bootstrap v5.3 CDN -->
    <link href="./assets/vendor/bootstrap-5.3.7/" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <!-- SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        /* Color Palette */
        --primary-orange: #fca311;
        --primary-black: #000000;
        --primary-blue: #14213d;
        --light-gray: #e5e5e5;
        --pure-white: #ffffff;

        /* Light mode colors */
        --bg-primary: var(--light-gray);
        --bg-secondary: var(--pure-white);
        --text-primary: var(--primary-black);
        --text-secondary: var(--primary-blue);
        --text-muted: #6b7280;
        --border-color: #d1d5db;
        --accent-color: var(--primary-orange);
        --shadow: rgba(0, 0, 0, 0.1);
        --sidebar-bg: var(--primary-blue);
        --card-bg: var(--pure-white);
      }

      [data-theme="dark"] {
        --bg-primary: var(--primary-black);
        --bg-secondary: var(--primary-blue);
        --text-primary: var(--pure-white);
        --text-secondary: var(--light-gray);
        --text-muted: #9ca3af;
        --border-color: #374151;
        --accent-color: var(--primary-orange);
        --shadow: rgba(0, 0, 0, 0.3);
        --sidebar-bg: var(--primary-blue);
        --card-bg: #1e293b;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition: all 0.3s ease;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Header Navigation */
      .top-nav {
        background: var(--pure-white);
        border-bottom: 3px solid var(--accent-color);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px var(--shadow);
      }

      [data-theme="dark"] .top-nav {
        background: var(--primary-blue);
        border-bottom-color: var(--accent-color);
      }

      .nav-brand {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-blue);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      [data-theme="dark"] .nav-brand {
        color: var(--pure-white);
      }

      .nav-brand i {
        color: var(--accent-color);
        font-size: 2rem;
      }

      .theme-toggle {
        background: var(--accent-color);
        border: none;
        color: var(--primary-black);
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 2px 8px rgba(252, 163, 17, 0.3);
      }

      .theme-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(252, 163, 17, 0.4);
      }

      /* Main Layout */
      .main-container {
        display: flex;
        flex: 1;
        gap: 2rem;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
      }

      /* Sidebar */
      .sidebar {
        background: var(--sidebar-bg);
        border-radius: 20px;
        padding: 2rem;
        width: 320px;
        height: fit-content;
        position: sticky;
        top: 120px;
        box-shadow: 0 10px 30px var(--shadow);
      }

      .sidebar h2 {
        color: var(--pure-white);
        font-size: 1.4rem;
        margin-bottom: 1.5rem;
        font-weight: 600;
      }

      .stats-grid {
        display: grid;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1.2rem;
        text-align: center;
        backdrop-filter: blur(10px);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--accent-color);
        display: block;
      }

      .stat-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 0.5rem;
      }

      .filter-section {
        margin-bottom: 2rem;
      }

      .filter-section h3 {
        color: var(--pure-white);
        font-size: 1.1rem;
        margin-bottom: 1rem;
        font-weight: 500;
      }

      .filter-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .filter-btn {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: rgba(255, 255, 255, 0.8);
        padding: 0.75rem 1rem;
        border-radius: 10px;
        text-align: left;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.95rem;
        width: 100%;
      }

      .filter-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--pure-white);
        border-color: var(--accent-color);
      }

      .filter-btn.active {
        background: var(--accent-color);
        color: var(--primary-black);
        border-color: var(--accent-color);
        font-weight: 600;
      }

      /* Content Area */
      .content-area {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .content-header {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px var(--shadow);
        border-left: 4px solid var(--accent-color);
      }

      .content-header h1 {
        font-size: 2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .content-header p {
        color: var(--text-muted);
        font-size: 1.1rem;
      }

      /* Task Input Form */
      .task-input-section {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px var(--shadow);
      }

      .input-group-custom {
        position: relative;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
      }

      .form-control-custom {
        flex: 1;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        font-size: 1rem;
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-family: inherit;
      }

      .form-control-custom:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
      }

      .form-control-custom::placeholder {
        color: var(--text-muted);
      }

      .btn-add-task {
        background: var(--accent-color);
        border: none;
        color: var(--primary-black);
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(252, 163, 17, 0.3);
      }

      .btn-add-task:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(252, 163, 17, 0.4);
      }

      /* Search Section */
      .search-section {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px var(--shadow);
      }

      .search-input-wrapper {
        position: relative;
      }

      .search-input {
        width: 100%;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 0.75rem 1rem 0.75rem 3rem;
        font-size: 1rem;
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        font-size: 1.1rem;
      }

      /* Todo List */
      .todo-list-container {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px var(--shadow);
        flex: 1;
      }

      .todo-list-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
      }

      .todo-list-header h3 {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .todo-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: move;
        position: relative;
        box-shadow: 0 2px 8px var(--shadow);
        border-left: 4px solid var(--accent-color);
      }

      .todo-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px var(--shadow);
      }

      .todo-item.completed {
        opacity: 0.7;
        border-left-color: #10b981;
      }

      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: var(--text-muted);
      }

      .todo-item.sortable-ghost {
        opacity: 0.5;
        transform: rotate(2deg);
      }

      .todo-item.sortable-chosen {
        transform: scale(1.02);
        box-shadow: 0 8px 24px var(--shadow);
        z-index: 100;
      }

      .drag-handle {
        color: var(--text-muted);
        cursor: move;
        font-size: 1.1rem;
        opacity: 0.6;
      }

      .todo-item:hover .drag-handle {
        opacity: 1;
        color: var(--accent-color);
      }

      .custom-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        background: var(--bg-secondary);
      }

      .custom-checkbox.checked {
        background: #10b981;
        border-color: #10b981;
      }

      .custom-checkbox.checked::after {
        content: "âœ“";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      .todo-text {
        flex: 1;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        word-break: break-word;
      }

      .todo-text.editing {
        display: none;
      }

      .edit-input {
        display: none;
        flex: 1;
        border: 2px solid var(--accent-color);
        border-radius: 8px;
        padding: 0.5rem;
        font-size: 1rem;
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      .edit-input.active {
        display: block;
      }

      .todo-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }

      .btn-action {
        border: none;
        border-radius: 8px;
        padding: 0.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        min-width: 36px;
        height: 36px;
      }

      .btn-edit {
        background: #3b82f6;
        color: white;
      }

      .btn-edit:hover {
        background: #2563eb;
        transform: scale(1.1);
      }

      .btn-delete {
        background: #ef4444;
        color: white;
      }

      .btn-delete:hover {
        background: #dc2626;
        transform: scale(1.1);
      }

      .btn-save {
        background: #10b981;
        color: white;
      }

      .btn-cancel {
        background: #6b7280;
        color: white;
      }

      .edit-buttons {
        display: none;
        gap: 0.5rem;
      }

      .edit-buttons.active {
        display: flex;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-muted);
      }

      .empty-state i {
        font-size: 4rem;
        color: var(--accent-color);
        margin-bottom: 1rem;
        opacity: 0.6;
      }

      .empty-state h4 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      /* Error Message */
      .error-message {
        color: #ef4444;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        font-weight: 500;
      }

      .validation-error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .main-container {
          flex-direction: column;
          padding: 1rem;
          gap: 1rem;
        }

        .sidebar {
          width: 100%;
          position: static;
          order: 2;
        }

        .content-area {
          order: 1;
        }

        .input-group-custom {
          flex-direction: column;
          align-items: stretch;
        }

        .btn-add-task {
          width: 100%;
          justify-content: center;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .filter-buttons {
          flex-direction: row;
          flex-wrap: wrap;
        }

        .filter-btn {
          flex: 1;
          min-width: 120px;
        }

        .nav-brand {
          font-size: 1.5rem;
        }

        .todo-item {
          flex-wrap: wrap;
          gap: 0.75rem;
        }

        .todo-text {
          min-width: 0;
          word-break: break-word;
        }
      }

      @media (max-width: 480px) {
        .top-nav .container {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }

        .main-container {
          padding: 0.5rem;
        }

        .content-header,
        .task-input-section,
        .search-section,
        .todo-list-container,
        .sidebar {
          padding: 1.5rem;
        }

        .todo-item {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body data-theme="light">
    <!-- Top Navigation -->
    <nav class="top-nav">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <a href="#" class="nav-brand">
            <i class="bi bi-kanban-fill"></i>
            TodoList
          </a>
          <button class="theme-toggle" id="themeToggle">
            <i class="bi bi-moon-fill"></i>
            Dark Mode
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <h2><i class="bi bi-bar-chart-fill"></i> Dashboard</h2>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-number" id="totalTasks">0</span>
            <div class="stat-label">Total Tasks</div>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="completedTasks">0</span>
            <div class="stat-label">Completed</div>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="pendingTasks">0</span>
            <div class="stat-label">Pending</div>
          </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
          <h3><i class="bi bi-funnel-fill"></i> Filter Tasks</h3>
          <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">
              <i class="bi bi-list-ul"></i>
              All Tasks
            </button>
            <button class="filter-btn" data-filter="pending">
              <i class="bi bi-clock"></i>
              Pending
            </button>
            <button class="filter-btn" data-filter="completed">
              <i class="bi bi-check-circle"></i>
              Completed
            </button>
          </div>
        </div>
      </aside>

      <!-- Content Area -->
      <main class="content-area">
        <!-- Header -->
        <div class="content-header">
          <h1>Your Task Management Hub</h1>
          <p>
            Stay organized and boost your productivity with our intuitive task
            manager
          </p>
        </div>

        <!-- Task Input -->
        <div class="task-input-section">
          <form id="formData">
            <div class="input-group-custom">
              <input
                type="text"
                class="form-control-custom"
                name="todo"
                id="todoInput"
                placeholder="What needs to be accomplished today?"
                autocomplete="off"
              />
              <button type="submit" class="btn-add-task">
                <i class="bi bi-plus-circle-fill"></i>
                Add Task
              </button>
            </div>
            <div
              id="errorMessage"
              class="error-message"
              style="display: none"
            ></div>
          </form>
        </div>

        <!-- Search -->
        <div class="search-section">
          <div class="search-input-wrapper">
            <i class="bi bi-search search-icon"></i>
            <input
              type="text"
              class="search-input"
              id="searchInput"
              placeholder="Search through your tasks..."
              autocomplete="off"
            />
          </div>
        </div>

        <!-- Todo List -->
        <div class="todo-list-container">
          <div class="todo-list-header">
            <h3><i class="bi bi-list-check"></i> Task List</h3>
          </div>

          <div id="todoList">
            <!-- Todo items will be rendered here -->
          </div>

          <!-- Empty State -->
          <div id="emptyState" class="empty-state" style="display: none">
            <i class="bi bi-clipboard-check"></i>
            <h4>No tasks found</h4>
            <p id="emptyStateText">
              Start by adding your first task to get organized!
            </p>
          </div>
        </div>
      </main>
    </div>

    <script>
      let todos = [];
      let currentFilter = "all";
      let currentSearch = "";
      let editingId = null;

      // Theme management
      function initTheme() {
        const savedTheme = "light";
        setTheme(savedTheme);
      }

      function setTheme(theme) {
        document.body.setAttribute("data-theme", theme);
        const themeToggle = document.getElementById("themeToggle");
        if (theme === "dark") {
          themeToggle.innerHTML = '<i class="bi bi-sun-fill"></i> Light Mode';
        } else {
          themeToggle.innerHTML = '<i class="bi bi-moon-fill"></i> Dark Mode';
        }
      }

      function toggleTheme() {
        const currentTheme = document.body.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        setTheme(newTheme);
      }

      function generateId() {
        return Date.now() + Math.random().toString(36).substr(2, 9);
      }

      function updateStats() {
        const total = todos.length;
        const completed = todos.filter((todo) => todo.completed).length;
        const pending = total - completed;

        document.getElementById("totalTasks").textContent = total;
        document.getElementById("completedTasks").textContent = completed;
        document.getElementById("pendingTasks").textContent = pending;
      }

      function getFilteredTodos() {
        let filtered = todos;

        // Apply filter
        if (currentFilter === "completed") {
          filtered = filtered.filter((todo) => todo.completed);
        } else if (currentFilter === "pending") {
          filtered = filtered.filter((todo) => !todo.completed);
        }

        // Apply search
        if (currentSearch.trim()) {
          filtered = filtered.filter((todo) =>
            todo.text.toLowerCase().includes(currentSearch.toLowerCase())
          );
        }

        return filtered;
      }

      function renderTodos() {
        const todoList = document.getElementById("todoList");
        const emptyState = document.getElementById("emptyState");
        const emptyStateText = document.getElementById("emptyStateText");

        todoList.innerHTML = "";
        const filteredTodos = getFilteredTodos();

        if (filteredTodos.length === 0) {
          emptyState.style.display = "block";
          if (currentSearch.trim()) {
            emptyStateText.textContent = `No tasks found matching "${currentSearch}"`;
          } else if (currentFilter === "completed") {
            emptyStateText.textContent = "No completed tasks yet";
          } else if (currentFilter === "pending") {
            emptyStateText.textContent = "No pending tasks";
          } else {
            emptyStateText.textContent =
              "Start by adding your first task to get organized!";
          }
          updateStats();
          return;
        }

        emptyState.style.display = "none";

        filteredTodos.forEach((item) => {
          const todoItem = document.createElement("div");
          todoItem.className = `todo-item ${item.completed ? "completed" : ""}`;
          todoItem.setAttribute("data-id", item.id);

          // Drag handle
          const dragHandle = document.createElement("i");
          dragHandle.className = "bi bi-grip-vertical drag-handle";

          // Custom checkbox
          const checkbox = document.createElement("div");
          checkbox.className = `custom-checkbox ${
            item.completed ? "checked" : ""
          }`;
          checkbox.addEventListener("click", () => {
            item.completed = !item.completed;
            renderTodos();
            saveTodos();
          });

          // Text container
          const textContainer = document.createElement("div");
          textContainer.style.flex = "1";
          textContainer.style.display = "flex";
          textContainer.style.alignItems = "center";

          const todoText = document.createElement("span");
          todoText.className = "todo-text";
          todoText.textContent = item.text;

          // Edit input (hidden by default)
          const editInput = document.createElement("input");
          editInput.type = "text";
          editInput.className = "edit-input";
          editInput.value = item.text;

          textContainer.appendChild(todoText);
          textContainer.appendChild(editInput);

          // Actions container
          const actionsContainer = document.createElement("div");
          actionsContainer.className = "todo-actions";

          // Edit button
          const editButton = document.createElement("button");
          editButton.className = "btn-action btn-edit";
          editButton.innerHTML = '<i class="bi bi-pencil"></i>';
          editButton.addEventListener("click", () => startEdit(item.id));

          // Edit buttons (hidden by default)
          const editButtonsContainer = document.createElement("div");
          editButtonsContainer.className = "edit-buttons";

          const saveButton = document.createElement("button");
          saveButton.className = "btn-action btn-save";
          saveButton.innerHTML = '<i class="bi bi-check"></i>';
          saveButton.addEventListener("click", () => saveEdit(item.id));

          const cancelButton = document.createElement("button");
          cancelButton.className = "btn-action btn-cancel";
          cancelButton.innerHTML = '<i class="bi bi-x"></i>';
          cancelButton.addEventListener("click", () => cancelEdit());

          editButtonsContainer.appendChild(saveButton);
          editButtonsContainer.appendChild(cancelButton);

          // Delete button
          const deleteButton = document.createElement("button");
          deleteButton.className = "btn-action btn-delete";
          deleteButton.innerHTML = '<i class="bi bi-trash"></i>';
          deleteButton.addEventListener("click", () => {
            if (confirm("Are you sure you want to delete this task?")) {
              todos = todos.filter((todo) => todo.id !== item.id);
              renderTodos();
              saveTodos();
            }
          });

          actionsContainer.appendChild(editButton);
          actionsContainer.appendChild(editButtonsContainer);
          actionsContainer.appendChild(deleteButton);

          todoItem.appendChild(dragHandle);
          todoItem.appendChild(checkbox);
          todoItem.appendChild(textContainer);
          todoItem.appendChild(actionsContainer);
          todoList.appendChild(todoItem);
        });

        updateStats();
        initializeSortable();
      }

      function startEdit(id) {
        if (editingId !== null) {
          cancelEdit();
        }

        editingId = id;
        const todoItem = document.querySelector(`[data-id="${id}"]`);
        const todoText = todoItem.querySelector(".todo-text");
        const editInput = todoItem.querySelector(".edit-input");
        const editButton = todoItem.querySelector(".btn-edit");
        const editButtons = todoItem.querySelector(".edit-buttons");

        todoText.classList.add("editing");
        editInput.classList.add("active");
        editButton.style.display = "none";
        editButtons.classList.add("active");
        editInput.focus();
        editInput.select();
      }

      function saveEdit(id) {
        const todoItem = document.querySelector(`[data-id="${id}"]`);
        const editInput = todoItem.querySelector(".edit-input");
        const newText = editInput.value.trim();

        if (newText === "") {
          showError("Task cannot be empty!");
          return;
        }

        // Check for duplicates (excluding current item)
        const isDuplicate = todos.some(
          (todo) =>
            todo.text.toLowerCase() === newText.toLowerCase() && todo.id !== id
        );

        if (isDuplicate) {
          showError("A task with this title already exists!");
          editInput.focus();
          editInput.select();
          return;
        }

        // Update the todo
        const todo = todos.find((todo) => todo.id === id);
        todo.text = newText;

        cancelEdit();
        renderTodos();
        saveTodos();
        hideError();
      }

      function cancelEdit() {
        if (editingId === null) return;

        const todoItem = document.querySelector(`[data-id="${editingId}"]`);
        const todoText = todoItem.querySelector(".todo-text");
        const editInput = todoItem.querySelector(".edit-input");
        const editButton = todoItem.querySelector(".btn-edit");
        const editButtons = todoItem.querySelector(".edit-buttons");

        // Reset the input value
        const todo = todos.find((todo) => todo.id === editingId);
        editInput.value = todo.text;

        todoText.classList.remove("editing");
        editInput.classList.remove("active");
        editButton.style.display = "flex";
        editButtons.classList.remove("active");

        editingId = null;
        hideError();
      }

      function initializeSortable() {
        const todoList = document.getElementById("todoList");
        if (todoList.children.length > 0) {
          new Sortable(todoList, {
            animation: 150,
            ghostClass: "sortable-ghost",
            chosenClass: "sortable-chosen",
            handle: ".drag-handle",
            onEnd: function (evt) {
              const filteredTodos = getFilteredTodos();
              const movedItem = filteredTodos[evt.oldIndex];

              // Remove from old position
              filteredTodos.splice(evt.oldIndex, 1);
              // Insert at new position
              filteredTodos.splice(evt.newIndex, 0, movedItem);

              // Update the main todos array with new order
              updateTodoOrder(filteredTodos);
              saveTodos();
            },
          });
        }
      }

      function updateTodoOrder(newOrder) {
        // Simple approach: assign order values based on position
        newOrder.forEach((todo, index) => {
          const originalTodo = todos.find((t) => t.id === todo.id);
          originalTodo.order = index;
        });

        // Sort todos array by order
        todos.sort((a, b) => (a.order || 0) - (b.order || 0));
      }

      function showError(message) {
        const errorElement = document.getElementById("errorMessage");
        const inputElement = document.getElementById("todoInput");

        errorElement.textContent = message;
        errorElement.style.display = "block";
        inputElement.classList.add("validation-error");
      }

      function hideError() {
        const errorElement = document.getElementById("errorMessage");
        const inputElement = document.getElementById("todoInput");

        errorElement.style.display = "none";
        inputElement.classList.remove("validation-error");
      }

      function saveTodos() {
        try {
          // Store todos data (in memory for this environment)
          const todosData = JSON.stringify(todos);
          console.log("Saving todos:", todosData);
        } catch (error) {
          console.warn("Could not save todos:", error);
        }
      }

      function loadTodos() {
        try {
          // In a real environment, this would load from storage
          todos = [];
        } catch (error) {
          console.warn("Could not load todos:", error);
          todos = [];
        }
      }

      // Event Listeners
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("formData");
        const searchInput = document.getElementById("searchInput");
        const filterButtons = document.querySelectorAll(".filter-btn");
        const themeToggle = document.getElementById("themeToggle");

        loadTodos();
        initTheme();

        // Theme toggle
        themeToggle.addEventListener("click", toggleTheme);

        // Form submission
        form.addEventListener("submit", function (event) {
          event.preventDefault();
          const todoInput = form.todo.value.trim();

          if (todoInput === "") {
            showError("Task cannot be empty!");
            return;
          }

          // Check for duplicates
          const isDuplicate = todos.some(
            (todo) => todo.text.toLowerCase() === todoInput.toLowerCase()
          );

          if (isDuplicate) {
            showError("A task with this title already exists!");
            return;
          }

          // Add new todo
          const newTodo = {
            id: generateId(),
            text: todoInput,
            completed: false,
            createdAt: new Date().toISOString(),
            order: todos.length,
          };

          todos.unshift(newTodo);

          form.todo.value = "";
          hideError();
          renderTodos();
          saveTodos();
        });

        // Search functionality
        searchInput.addEventListener("input", function () {
          currentSearch = this.value;
          renderTodos();
        });

        // Filter functionality
        filterButtons.forEach((button) => {
          button.addEventListener("click", function () {
            // Remove active class from all buttons
            filterButtons.forEach((btn) => btn.classList.remove("active"));
            // Add active class to clicked button
            this.classList.add("active");

            currentFilter = this.getAttribute("data-filter");
            renderTodos();
          });
        });

        // Hide error when typing
        document
          .getElementById("todoInput")
          .addEventListener("input", function () {
            if (this.value.trim()) {
              hideError();
            }
          });

        // Handle escape key to cancel editing
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && editingId !== null) {
            cancelEdit();
          }
        });

        renderTodos();
      });

      // Auto-save periodically
      setInterval(saveTodos, 30000);
    </script>
  </body>
</html>
